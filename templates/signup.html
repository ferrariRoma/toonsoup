<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <title>Document</title>
    <link rel="stylesheet" href="/static/css/signstyle.css">
</head>

<body>
    <header>
        <h1 class="m-0 text-primary logo-toonsoup">íˆ°ìˆ²ğŸŒ³</h1>
    </header>
    <div class="container">
        <div class="wrap">
            <div>
                <h1 class="title">íšŒì›ê°€ì…</h1>
                <p class="sub-title">TOONSOUPì—ì„œ ë‹¤ì–‘í•œ ì›¹íˆ°ì— ëŒ€í•œ ì •ë³´ì™€ <br>ì˜ê²¬ì„ ë‚˜ëˆ ë³´ì„¸ìš”!</p>
            </div>
            <hr class="signUp-div" />
            <form id="signup" action="">
                <div>
                    <h3><label for="name">ì´ë¦„</label></h3>
                    <input class="input" id="name" type="text" autocomplete="off" required>
                    <h3><label for="id">ì•„ì´ë””</label></h3>
                    <input class="input" id="id" type="text" autocomplete="off" required>
                    <h3><label for="pw">ë¹„ë°€ë²ˆí˜¸</label></h3>
                    <input onchange="checkPw()" class="input" id="pw" type="password" autocomplete="off" required>
                    <h3><label for="pwConfirm">ë¹„ë°€ë²ˆí˜¸ ì¬í™•ì¸</label></h3>
                    <input onchange="checkPw()" class="input" id="pw2" type="password" autocomplete="off" required>
                    <p id="error-alert">ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</p>
                </div>
                <div>
                    <button onClick="signUp()" class="btn" id="btn" type="submit">íšŒì›ê°€ì…</button>
                </div>
            </form>
        </div>
    </div>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script>
        // íšŒì›ê°€ì…ì˜ í•„ë„ê°€ ë¹„ì–´ìˆìœ¼ë©´ ë²„íŠ¼ì„ ë¹„í™œì„±í™”í•˜ëŠ” ì½”ë“œ
        $('.btn').attr('disabled', 'disabled');
        $(document).ready(function () {
            $('#signup input').keyup(function () {

                var empty = false;
                $('#signup input').each(function () {
                    if ($(this).val().length == 0) {
                        empty = true;
                    }
                });

                if (empty) {
                    $('.btn').attr('disabled', 'disabled');
                } else {
                    $('.btn').removeAttr('disabled');
                }
            });
        });


        // ë¹„ë°€ë²ˆí˜¸ì™€ ì¬í™•ì¸ì´ ì„œë¡œ ë§ì§€ ì•Šìœ¼ë©´ ê²½ê³ ë¥¼ ì¶œë ¥í•˜ëŠ” ì½”ë“œ
        const checkPw = () => {
            if (document.querySelector('#pw').value != '' && document.querySelector('#pw2').value != '') {
                if (document.querySelector('#pw').value == document.querySelector('#pw2').value) {
                    document.querySelector('#error-alert').innerText = 'ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•©ë‹ˆë‹¤.'
                    document.querySelector('#error-alert').style.color = 'blue';
                    $('#error-alert').show()
                }
                else {
                    document.querySelector('#error-alert').innerText = 'ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.';
                    document.querySelector('#error-alert').style.color = 'red';
                    $('#error-alert').show()
                }
            }
        }


        // íšŒì›ê°€ì… ë²„íŠ¼ ëˆŒë €ì„ ë•Œ DBì— ë°ì´í„°ë¥¼ ì €ì¥í•˜ëŠ” ì½”ë“œ
        const signUp = () => {
            if (document.querySelector('#pw').value == document.querySelector('#pw2').value) {
                let name = $('#name').val()
                let id = $('#id').val()
                let pw = $('#pw').val()

                $.ajax({
                    type: 'POST',
                    url: '/signup/post',
                    data: {
                        name_give: name,
                        id_give: id,
                        pw_give: pw
                    },
                    success: function (response) {
                        alert(response['msg'])
                        window.location.replace('/login')
                    }
                })
            } else {
                alert('ì…ë ¥í•œ ì •ë³´ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.')
            }

        }
    </script>
</body>

</html>